{"version":3,"file":"js/script.js","mappings":"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","sources":["webpack://duplicatefinder/./js-src/main/index.js"],"sourcesContent":["/* global OC, fetch */\n(function () {\n  const baseUrl = OC.generateUrl('/apps/duplicatefinder/api')\n  const element = document.getElementById('container')\n  const loader = document.getElementById('loader-container')\n  const loaderBtn = document.getElementById('loader-btn')\n  const title = document.getElementById('title')\n  const groupedResult = {\n    groupedItems: [],\n    totalSize: 0,\n    itemCount: 0,\n    uniqueTotalSize: 0\n  }\n  let offset = 0\n\n  function render (items) {\n    loader.style.display = 'none'\n\n    if (groupedResult.itemCount === 0) {\n      updateTitle('0 duplicate file found')\n    } else {\n      updateTitleWithStats()\n\n      items.forEach((duplicate) => {\n        if (duplicate && Array.isArray(duplicate.files) && duplicate.files.length > 0) {\n          const groupDOM = getGroupElement(duplicate)\n          element.appendChild(groupDOM)\n        }\n      })\n    }\n  }\n\n  function updateTitle (sTitle) {\n    title.innerHTML = sTitle\n  }\n\n  function updateTitleWithStats () {\n    const spaceUsedByDublicateFiles = OC.Util.humanFileSize(groupedResult.totalSize - groupedResult.uniqueTotalSize)\n\n    updateTitle(groupedResult.itemCount + ' files found. Total: ' + OC.Util.humanFileSize(groupedResult.totalSize) + '. ' + spaceUsedByDublicateFiles + ' of space could be freed.')\n  }\n\n  function isImage (item) {\n    return item.mimetype.substr(0, item.mimetype.indexOf('/')) === 'image'\n  }\n\n  function isVideo (item) {\n    return item.mimetype.substr(0, item.mimetype.indexOf('/')) === 'video'\n  }\n\n  function getPreviewImage (item) {\n    if (isImage(item) || isVideo(item)) {\n      const query = new URLSearchParams({\n        file: normalizeItemPath(item.path),\n        fileId: item.nodeId,\n        x: 500,\n        y: 500,\n        forceIcon: 0\n      })\n      return OC.generateUrl('/core/preview.png?') + query.toString()\n    }\n\n    return OC.MimeType.getIconUrl(item.mimetype)\n  }\n\n  function normalizeItemPath (path) {\n    return path.match(/\\/([^/]*)\\/files(\\/.*)/)[2]\n  }\n\n  function deleteItem (item, e) {\n    const fileClient = OC.Files.getClient()\n    let iconEl\n    if (e.target.className === 'icon icon-delete') {\n      iconEl = e.target\n    } else {\n      iconEl = e.target.getElementsByClassName('icon-delete')[0]\n    }\n    iconEl.classList.replace('icon-delete', 'icon-loading')\n\n    fileClient.remove(normalizeItemPath(item.path)).then(function () {\n      groupedResult.groupedItems.forEach(cleanGroupItems.bind(undefined, item))\n      updateTitleWithStats()\n    }).fail(function () {\n      iconEl.classList.replace('icon-loading', 'icon-delete')\n      OC.dialogs.alert('Error deleting the file: ' + normalizeItemPath(item.path), 'Error')\n    })\n  }\n\n  function cleanGroupItems (item, grp, i) {\n    grp.files.forEach((file, j) => {\n      if (file.path === item.path) {\n        if (document.getElementById(grp.id + '-file-' + file.id) !== null) {\n          document.getElementById(grp.id + '-file-' + file.id).remove()\n        }\n        groupedResult.totalSize -= item.size\n        groupedResult.itemCount -= 1\n        grp.files.splice(j, 1)\n      }\n    })\n    if (grp.files.length <= 1) {\n      if (document.getElementById('grp-' + grp.id) !== null) {\n        document.getElementById('grp-' + grp.id).remove()\n      }\n      groupedResult.totalSize -= item.size\n      groupedResult.itemCount -= 1\n      groupedResult.uniqueTotalSize -= item.size\n      groupedResult.groupedItems.splice(i, 1)\n    }\n  }\n\n  function getGroupElement (group) {\n    const groupItems = group.files\n    const groupContainer = document.createElement('div')\n    groupContainer.setAttribute('id', 'grp-' + group.id)\n    groupContainer.setAttribute('class', 'duplicates')\n\n    const sizeDiv = document.createElement('div')\n    sizeDiv.setAttribute('class', 'filesize')\n\n    groupItems.forEach(function (item) {\n      const itemDiv = getItemElement(item, group.id)\n      groupContainer.appendChild(itemDiv)\n      if (item && item.size) {\n        sizeDiv.innerHTML = OC.Util.humanFileSize(item.size)\n      }\n    })\n    groupContainer.appendChild(sizeDiv)\n    return groupContainer\n  }\n\n  function getItemElement (item, grpId) {\n    // Item wrapper container\n    const itemDiv = document.createElement('div')\n    itemDiv.setAttribute('id', grpId + '-file-' + item.id)\n    itemDiv.setAttribute('class', 'element')\n\n    // Delete button\n    const deleteButton = document.createElement('button')\n    deleteButton.innerHTML = '<span class=\"icon icon-delete\"></span>'\n    deleteButton.setAttribute('class', 'button-delete')\n    deleteButton.addEventListener('click', function (e) {\n      deleteItem(item, e)\n    })\n    itemDiv.appendChild(deleteButton)\n\n    // Preview image\n    const previewImage = document.createElement('div')\n    previewImage.setAttribute('class', 'thumbnail')\n    previewImage.style.backgroundImage = \"url('\" + getPreviewImage(item) + \"')\"\n    itemDiv.appendChild(previewImage)\n\n    // Label container on the right\n    const labelContainer = document.createElement('div')\n\n    // Item path\n    const itemPath = document.createElement('h1')\n    itemPath.setAttribute('class', 'path')\n    itemPath.innerHTML = normalizeItemPath(item.path)\n    labelContainer.appendChild(itemPath)\n\n    const actions = [\n      {\n        icon: 'icon-file',\n        url: function (selectedItem) {\n          const dir = OC.dirname(normalizeItemPath(selectedItem.path))\n\n          return OC.generateUrl('/apps/files/?dir=' + dir + '&openfile=' + selectedItem.nodeId)\n        },\n        description: 'Show file'\n      },\n      {\n        icon: 'icon-details',\n        url: function (selectedItem) {\n          return OC.generateUrl('/f/' + selectedItem.nodeId)\n        },\n        description: 'Show details'\n      }\n    ]\n    const actionsContainer = document.createElement('div')\n    actionsContainer.setAttribute('class', 'fileactions')\n\n    actions.forEach(action => {\n      const actionLink = document.createElement('a')\n      actionLink.setAttribute('href', action.url.call(null, item))\n      actionLink.setAttribute('class', 'action permanent')\n      actionLink.setAttribute('title', action.description)\n\n      const actionIcon = document.createElement('span')\n      actionIcon.setAttribute('class', 'icon ' + action.icon)\n      actionLink.appendChild(actionIcon)\n\n      actionsContainer.appendChild(actionLink)\n    })\n\n    labelContainer.appendChild(actionsContainer)\n\n    // Item hash\n    const hashContainer = document.createElement('h1')\n    hashContainer.setAttribute('class', 'hash')\n    hashContainer.innerHTML = item.fileHash\n    labelContainer.appendChild(hashContainer)\n\n    itemDiv.appendChild(labelContainer)\n\n    return itemDiv\n  }\n\n  async function loadFiles () {\n    loader.style.display = 'inherit'\n    loaderBtn.style.display = 'none'\n    let response\n    try {\n      response = await fetch(baseUrl + '/v1/Duplicates?offset=' + offset, {\n        redirect: 'error'\n      })\n\n      const result = await response.json()\n      const items = result.data.entities\n\n      if (items.length > 0) {\n        offset = result.data.pageKey\n        if (!result.data.isLastFetched) {\n          loaderBtn.style.display = 'inherit'\n        }\n      } else {\n        loaderBtn.removeEventListener('click', loadFiles)\n      }\n\n      items.forEach((duplicate, i) => {\n        duplicate.files = Object.values(duplicate.files)\n        if (duplicate.files.length > 0) {\n          groupedResult.totalSize += duplicate.files[0].size * duplicate.files.length\n          groupedResult.itemCount += duplicate.files.length\n          groupedResult.uniqueTotalSize += duplicate.files[0].size\n        } else {\n          items.splice(i, 1)\n        }\n      })\n      // Sort desending by size\n      items.sort((a, b) => {\n        if (Array.isArray(b.files) && Array.isArray(a.files) &&\n              b.files.length > 0 && a.files.length > 0) {\n          return Math.abs((b.files[0].size * b.files.length) - (a.files[0].size * a.files.length))\n        } else {\n          return -1\n        }\n      })\n      groupedResult.groupedItems = groupedResult.groupedItems.concat(items)\n\n      render(items)\n    } catch (e) {\n      console.error('duplicatefinder: API Fetching', e, response)\n      loader.style.display = 'none'\n      const errorElement = document.createElement('div')\n      errorElement.innerHTML = 'Failed to load duplicates'\n      errorElement.style = 'width: 100%; color: rgb(132, 32, 41); background-color: rgb(248, 215, 218); border-color: rgb(245, 194, 199);height: 4em;line-height: 4em;padding-left: 1em;border: 1px solid rgb(245, 194, 199);border-radius: .25rem;'\n      element.appendChild(errorElement)\n    }\n  }\n\n  loadFiles()\n  loaderBtn.addEventListener('click', loadFiles)\n})()\n"],"names":["baseUrl","OC","generateUrl","element","document","getElementById","loader","loaderBtn","title","groupedResult","groupedItems","totalSize","itemCount","uniqueTotalSize","offset","render","items","style","display","updateTitle","updateTitleWithStats","forEach","duplicate","Array","isArray","files","length","groupDOM","getGroupElement","appendChild","sTitle","innerHTML","spaceUsedByDublicateFiles","Util","humanFileSize","isImage","item","mimetype","substr","indexOf","isVideo","getPreviewImage","query","URLSearchParams","file","normalizeItemPath","path","fileId","nodeId","x","y","forceIcon","toString","MimeType","getIconUrl","match","deleteItem","e","fileClient","Files","getClient","iconEl","target","className","getElementsByClassName","classList","replace","remove","then","cleanGroupItems","bind","undefined","fail","dialogs","alert","grp","i","j","id","size","splice","group","groupItems","groupContainer","createElement","setAttribute","sizeDiv","itemDiv","getItemElement","grpId","deleteButton","addEventListener","previewImage","backgroundImage","labelContainer","itemPath","actions","icon","url","selectedItem","dir","dirname","description","actionsContainer","action","actionLink","call","actionIcon","hashContainer","fileHash","loadFiles","fetch","redirect","response","json","result","data","entities","pageKey","isLastFetched","removeEventListener","Object","values","sort","a","b","Math","abs","concat","console","error","errorElement"],"sourceRoot":""}